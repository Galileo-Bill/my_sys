#!/bin/sh
printf '\e[31m
 ______     ______     ______   ______   __     __   __     ______        __  __     ______      ______     ______     __    __     ______     
/\  ___\   /\  ___\   /\__  _\ /\__  _\ /\ \   /\ "-.\ \   /\  ___\      /\ \/\ \   /\  == \    /\  ___\   /\  __ \   /\ "-./  \   /\  == \    
\ \___  \  \ \  __\   \/_/\ \/ \/_/\ \/ \ \ \  \ \ \-.  \  \ \ \__ \     \ \ \_\ \  \ \  _-/    \ \ \____  \ \  __ \  \ \ \-./\ \  \ \  _-/    
 \/\_____\  \ \_____\    \ \_\    \ \_\  \ \_\  \ \_\\"\_\  \ \_____\     \ \_____\  \ \_\       \ \_____\  \ \_\ \_\  \ \_\ \ \_\  \ \_\      
  \/_____/   \/_____/     \/_/     \/_/   \/_/   \/_/ \/_/   \/_____/      \/_____/   \/_/        \/_____/   \/_/\/_/   \/_/  \/_/   \/_/      
                                                                                                                                               
'
if [ "$1" == "remount" ]; then
  diskutil mount /dev/disk0s4
else
  #Get mount point of bootcamp
  disk=$(mount | grep 'BOOTCAMP' | cut -d" " -f1)
  printf "\e[1;31m\e[47mSetting up permissions....\e[0m\n"
  chmod 777 $disk
  printf "\e[1;31m\e[47mUnmounting Bootcamp parition ($disk)....\e[0m\n"
  diskutil umount $disk
  line=$(awk 'NR==12' ~/VirtualBox\ VMs/Bootcamp/bootcamp.vmdk)
  if [ "$line" != "RW 78125000 FLAT \"$disk\" 0" ]; then
    printf "\e[1;37m\e[41mThe virtual machine is refering to the wrong partition and will not boot!!\e[0m\n"
  else
    printf "\e[1;31m\e[47mStarting virtual machine....\e[0m\n"
    vboxmanage startvm Bootcamp
  fi
  export disk=$disk
fi 
